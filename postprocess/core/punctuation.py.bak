import re
from utils.log import setup_logger

logger = setup_logger("punctuation")

def insert_korean_punctuation(text: str) -> str:
    """
    한국어 일반 문장용 구두점 삽입기 (마침표 및 쉼표)
    """
    # ✅ 1. 종결 표현 뒤에 마침표
    sentence_ends = ["니다", "다", "요"]
    for ending in sentence_ends:
        pattern = rf"({ending})(?![.\w])"
        text = re.sub(pattern, r"\1.", text)

    # ✅ 2. 중복 마침표 정리 (예: "입니다..")
    text = re.sub(r"\.{2,}", ".", text)

    # ✅ 3. 나열/연결부 쉼표 삽입 (간단 버전)
    comma_rules = [
        (" 그리고", ", 그리고"),
        (" 그러나", ", 그러나"),
        (" 하지만", ", 하지만"),
        (" 또는", ", 또는"),
        (" 혹은", ", 혹은"),
        (" 및", ", 및"),
    ]
    for before, after in comma_rules:
        text = text.replace(before, after)

    # ✅ 4. 마침표 뒤 공백 없을 경우 공백 추가
    text = re.sub(r"\.(?![\s\n])", ". ", text)

    return text.strip()
